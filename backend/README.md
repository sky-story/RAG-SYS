# åŒ–å·¥è¡Œä¸šå¤§æ¨¡å‹çŸ¥è¯†åº“ - åç«¯

åŸºäº Flask + MongoDB çš„æ–‡æ¡£ç®¡ç†å’Œ RAG é—®ç­”ç³»ç»Ÿåç«¯æœåŠ¡ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.8+
- MongoDB 4.4+
- æ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

### å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### é…ç½®ç¯å¢ƒ

1. ç¡®ä¿ MongoDB æœåŠ¡æ­£åœ¨è¿è¡Œ
2. æ ¹æ®éœ€è¦ä¿®æ”¹ `config.py` ä¸­çš„é…ç½®é¡¹ï¼š
   - `MONGO_URI`: MongoDB è¿æ¥å­—ç¬¦ä¸²
   - `UPLOAD_FOLDER`: æ–‡ä»¶ä¸Šä¼ ç›®å½•
   - `MAX_CONTENT_LENGTH`: æœ€å¤§æ–‡ä»¶å¤§å°é™åˆ¶

### å¯åŠ¨æœåŠ¡

```bash
python app.py
```

æœåŠ¡å°†åœ¨ `http://localhost:5000` å¯åŠ¨ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app.py                 # Flask åº”ç”¨å…¥å£
â”œâ”€â”€ config.py             # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt      # Python ä¾èµ–
â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ file_model.py    # æ–‡ä»¶æ¨¡å‹
â”œâ”€â”€ controllers/         # ä¸šåŠ¡é€»è¾‘æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ file_controller.py # æ–‡ä»¶æ§åˆ¶å™¨
â”œâ”€â”€ routes/              # API è·¯ç”±
â”‚   â”œâ”€â”€ upload_routes.py # æ–‡ä»¶ä¸Šä¼ è·¯ç”±
â”‚   â”œâ”€â”€ parse_routes.py  # æ–‡æ¡£è§£æè·¯ç”±ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ segment_routes.py # æ–‡æ¡£åˆ†æ®µè·¯ç”±ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ qa_routes.py     # é—®ç­”è·¯ç”±ï¼ˆå¾…å®ç°ï¼‰
â””â”€â”€ services/            # æœåŠ¡å±‚ï¼ˆå¾…å®ç°ï¼‰
```

## ğŸ”— API æ¥å£

### æ–‡ä»¶ä¸Šä¼ æ¨¡å—

#### 1. ä¸Šä¼ æ–‡ä»¶
- **POST** `/api/upload`
- **æè¿°**: ä¸Šä¼ å•ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶
- **æ”¯æŒæ ¼å¼**: PDF, DOCX, DOC, TXT
- **æ–‡ä»¶å¤§å°é™åˆ¶**: 100MB

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X POST -F "file=@document.pdf" http://localhost:5000/api/upload
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "Successfully uploaded 1 files",
  "data": {
    "uploaded": [
      {
        "id": "64f1234567890abcdef12345",
        "filename": "document.pdf",
        "saved_as": "20231201_143022_uuid.pdf",
        "size": 1048576,
        "type": "pdf"
      }
    ],
    "failed": [],
    "total": 1
  }
}
```

#### 2. è·å–æ–‡ä»¶åˆ—è¡¨
- **GET** `/api/files`
- **æè¿°**: è·å–æ‰€æœ‰ä¸Šä¼ æ–‡ä»¶çš„å…ƒæ•°æ®
- **å‚æ•°**: 
  - `page`: é¡µç ï¼ˆé»˜è®¤ 1ï¼‰
  - `per_page`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ 50ï¼Œæœ€å¤§ 100ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": "64f1234567890abcdef12345",
      "name": "20231201_143022_uuid.pdf",
      "original_name": "document.pdf",
      "type": "pdf",
      "size": 1048576,
      "upload_time": "2023-12-01T14:30:22.123Z",
      "status": "uploaded"
    }
  ],
  "pagination": {
    "page": 1,
    "per_page": 50,
    "total": 1,
    "pages": 1
  }
}
```

#### 3. åˆ é™¤æ–‡ä»¶
- **DELETE** `/api/files/{file_id}`
- **æè¿°**: åˆ é™¤æŒ‡å®šæ–‡ä»¶ï¼ˆæœ¬åœ°æ–‡ä»¶å’Œæ•°æ®åº“è®°å½•ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "File deleted successfully"
}
```

#### 4. ä¸‹è½½æ–‡ä»¶
- **GET** `/api/files/download/{file_id}`
- **æè¿°**: ä¸‹è½½æŒ‡å®šæ–‡ä»¶
- **å“åº”**: ç›´æ¥è¿”å›æ–‡ä»¶å†…å®¹

#### 5. æ–‡ä»¶ç»Ÿè®¡
- **GET** `/api/files/stats`
- **æè¿°**: è·å–æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "total_files": 5,
    "by_type": {
      "pdf": 3,
      "docx": 1,
      "txt": 1
    },
    "upload_folder": "/path/to/data"
  }
}
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### files é›†åˆ

```javascript
{
  "_id": ObjectId,
  "name": "20231201_143022_uuid.pdf",           // å­˜å‚¨çš„æ–‡ä»¶å
  "original_name": "document.pdf",              // åŸå§‹æ–‡ä»¶å
  "path": "/path/to/data/20231201_143022_uuid.pdf", // æ–‡ä»¶è·¯å¾„
  "type": "pdf",                               // æ–‡ä»¶ç±»å‹
  "size": 1048576,                             // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  "upload_time": ISODate("2023-12-01T14:30:22.123Z"), // ä¸Šä¼ æ—¶é—´
  "status": "uploaded",                        // æ–‡ä»¶çŠ¶æ€
  "mime_type": "application/pdf",              // MIME ç±»å‹
  "created_at": ISODate("2023-12-01T14:30:22.123Z"),  // åˆ›å»ºæ—¶é—´
  "updated_at": ISODate("2023-12-01T14:30:22.123Z")   // æ›´æ–°æ—¶é—´
}
```

## ğŸ› ï¸ å¼€å‘è¯´æ˜

### é”™è¯¯å¤„ç†

æ‰€æœ‰ API æ¥å£è¿”å›ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼ï¼š

```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

### æ–‡ä»¶å­˜å‚¨ç­–ç•¥

- æ–‡ä»¶ä½¿ç”¨ UUID + æ—¶é—´æˆ³å‘½åï¼Œé¿å…é‡åå†²çª
- åŸå§‹æ–‡ä»¶åä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨äºä¸‹è½½æ—¶æ˜¾ç¤º
- æ–‡ä»¶å­˜å‚¨åœ¨ `data/` ç›®å½•ä¸‹

### å®‰å…¨è€ƒè™‘

- æ–‡ä»¶ç±»å‹ç™½åå•éªŒè¯
- æ–‡ä»¶å¤§å°é™åˆ¶
- æ–‡ä»¶åå®‰å…¨å¤„ç†
- è·¯å¾„éå†æ”»å‡»é˜²æŠ¤

## ğŸ”„ ä¸‹ä¸€æ­¥å¼€å‘

1. **æ–‡æ¡£è§£ææ¨¡å—** (`parse_routes.py`)
   - PDF/DOCX æ–‡æœ¬æå–
   - æ–‡æ¡£é¢„å¤„ç†å’Œæ¸…æ´—

2. **æ–‡æ¡£åˆ†æ®µæ¨¡å—** (`segment_routes.py`)
   - æ™ºèƒ½åˆ†æ®µç®—æ³•
   - æ®µè½æ ‡ç­¾ç®¡ç†

3. **é—®ç­”æ¨¡å—** (`qa_routes.py`)
   - å‘é‡åŒ–å’ŒåµŒå…¥
   - RAG æ£€ç´¢å’Œç”Ÿæˆ

4. **ç”¨æˆ·ç®¡ç†æ¨¡å—**
   - ç”¨æˆ·è®¤è¯å’Œæˆæƒ
   - è®¿é—®æƒé™æ§åˆ¶

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. MongoDB æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. ä¸Šä¼ ç›®å½•æ˜¯å¦æœ‰å†™å…¥æƒé™
3. ä¾èµ–åŒ…æ˜¯å¦æ­£ç¡®å®‰è£…
4. é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®è®¾ç½®